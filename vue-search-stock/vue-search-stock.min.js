/*!
 * vue-search-stock v1.0.0 
 * (c) 2017 cklwblove
 * A Vue.js Plugin
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueSearchStock=t()}(this,function(){"use strict";function e(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("media","screen"),t.innerHTML=e,document.head.appendChild(t),e}}function t(e,t){if(!e||!t)return!1;if(-1!==t.indexOf(" "))throw new Error("className should not contain space.");return e.classList?e.classList.contains(t):(" "+e.className+" ").indexOf(" "+t+" ")>-1}function n(e,n){if(e){for(var o=e.className,i=(n||"").split(" "),s=0,a=i.length;s<a;s++){var r=i[s];r&&(e.classList?e.classList.add(r):t(e,r)||(o+=" "+r))}e.classList||(e.className=o)}}function o(e,n){if(e&&n){for(var o=n.split(" "),i=" "+e.className+" ",s=0,r=o.length;s<r;s++){var l=o[s];l&&(e.classList?e.classList.remove(l):t(e,l)&&(i=i.replace(" "+l+" "," ")))}e.classList||(e.className=a(i))}}function i(e,t){void 0===t&&(t={}),e.component(y.name,y)}e(".search-stock-box input:-webkit-autofill,\n.search-stock-box textarea:-webkit-autofill,\n.search-stock-box select:-webkit-autofill {\n  background-color: #faffbd;\n  color: #000000;\n}\n.search-stock-box ul {\n  padding: 0;\n  margin: 0;\n}\n.search-stock-box .search-bar {\n  background-color: #fff;\n  height: 44px;\n  width: 100%;\n  box-sizing: border-box;\n  padding: 0 8px;\n  overflow: hidden;\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 200;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: -webkit-flex;\n  display: flex;\n  -webkit-box-align: center;\n  -ms-flex-align: center;\n  -webkit-align-items: center;\n  align-items: center;\n  -webkit-transition: background 0.3s;\n  transition: background 0.3s;\n  border-bottom: 1px solid #E3E5E6;\n}\n.search-stock-box .search-bar-input {\n  border: 1px solid #E8E8E8;\n  background-color: #f6f6f6;\n  border-radius: 4px;\n  width: 100%;\n  height: 28px;\n  position: relative;\n  -webkit-flex-shrink: 1;\n  -ms-flex: 0 1 auto;\n  flex-shrink: 1;\n}\n.search-stock-box .search-bar-input form {\n  box-sizing: border-box;\n  width: 100%;\n  height: 100%;\n}\n.search-stock-box .search-bar-input input[type=search] {\n  box-sizing: border-box;\n  width: 100%;\n  display: block;\n  border: none;\n  outline: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  -ms-appearance: none;\n  appearance: none;\n  border-radius: 5px;\n  font-family: inherit;\n  color: #000;\n  font-size: 14px;\n  font-weight: 400;\n  background-color: #f6f6f6;\n  padding: 10px 28px;\n  height: 100%;\n  background-repeat: no-repeat;\n  background-position: 8px center;\n  background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20viewBox%3D'0%200%2013%2013'%20enable-background%3D'new%200%200%2013%2013'%3E%3Cg%3E%3Cpath%20fill%3D'%23939398'%20d%3D'M5%2C1c2.2%2C0%2C4%2C1.8%2C4%2C4S7.2%2C9%2C5%2C9S1%2C7.2%2C1%2C5S2.8%2C1%2C5%2C1%20M5%2C0C2.2%2C0%2C0%2C2.2%2C0%2C5s2.2%2C5%2C5%2C5s5-2.2%2C5-5S7.8%2C0%2C5%2C0%20L5%2C0z'%2F%3E%3C%2Fg%3E%3Cline%20stroke%3D'%23939398'%20stroke-miterlimit%3D'10'%20x1%3D'12.6'%20y1%3D'12.6'%20x2%3D'8.2'%20y2%3D'8.2'%2F%3E%3C%2Fsvg%3E\");\n  background-size: 13px 13px;\n}\n.search-stock-box .search-cancel {\n  -webkit-transition-duration: .3s;\n  transition-duration: .3s;\n  -webkit-transform: translate3d(0, 0, 0);\n  transform: translate3d(0, 0, 0);\n  font-size: 14px;\n  margin-left: 8px;\n  pointer-events: auto;\n  -webkit-flex-shrink: 0;\n  -ms-flex: 0 0 auto;\n  flex-shrink: 0;\n  color: #43a9f1;\n  text-decoration: none;\n}\n.search-stock-box .search-content {\n  padding-top: 44px;\n  overflow: auto;\n  -webkit-overflow-scrolling: touch;\n  box-sizing: border-box;\n  height: 100%;\n  position: relative;\n  z-index: 1;\n}\n.search-stock-box .search-content-box {\n  width: 100%;\n  margin: 0;\n}\n.search-stock-box .search-content-box li {\n  list-style: none;\n  border-bottom: solid 1px #ebebeb;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: justify;\n  -ms-flex-pack: justify;\n  justify-content: space-between;\n  color: #31323b;\n  padding: 10px 15px;\n}\n.search-stock-box .search-content-box li span {\n  font-size: 12px;\n}\n.search-stock-box .search-content-box li.no-data {\n  justify-content: center;\n  border-bottom: none;\n}\n.search-stock-box .search-content-box li.no-data span {\n  font-size: 14px;\n}\n.search-stock-box .infinite-scroll-preloader {\n  text-align: center;\n  margin-top: 10px;\n}\n.search-stock-box .preloader {\n  display: inline-block;\n  width: 34px;\n  height: 34px;\n  background-image: url(\"data:image/svg+xml;charset=utf-8,%3Csvg%20viewBox%3D'0%200%20120%20120'%20xmlns%3D'http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg'%20xmlns%3Axlink%3D'http%3A%2F%2Fwww.w3.org%2F1999%2Fxlink'%3E%3Cdefs%3E%3Cline%20id%3D'l'%20x1%3D'60'%20x2%3D'60'%20y1%3D'7'%20y2%3D'27'%20stroke%3D'%236c6c6c'%20stroke-width%3D'11'%20stroke-linecap%3D'round'%2F%3E%3C%2Fdefs%3E%3Cg%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(30%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(60%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(90%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(120%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.27'%20transform%3D'rotate(150%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.37'%20transform%3D'rotate(180%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.46'%20transform%3D'rotate(210%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.56'%20transform%3D'rotate(240%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.66'%20transform%3D'rotate(270%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.75'%20transform%3D'rotate(300%2060%2C60)'%2F%3E%3Cuse%20xlink%3Ahref%3D'%23l'%20opacity%3D'.85'%20transform%3D'rotate(330%2060%2C60)'%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E\");\n  background-position: 50%;\n  background-size: 100%;\n  background-repeat: no-repeat;\n  -webkit-animation: preloader-spin 1s steps(12, end) infinite;\n  animation: preloader-spin 1s steps(12, end) infinite;\n}\n@-webkit-keyframes preloader-spin {\n  100% {\n    -webkit-transform: rotate(360deg);\n  }\n}\n@keyframes preloader-spin {\n  100% {\n    transform: rotate(360deg);\n  }\n}\n"),e(".c-popup {\n  position: fixed;\n  background: #fff;\n  width: 100%;\n  height: 100%;\n  top: 50%;\n  left: 50%;\n  transform: translate3d(-50%, -50%, 0);\n  backface-visibility: hidden;\n  transition: 0.4s ease-out;\n}\n.c-popup-bottom {\n  top: auto;\n  right: auto;\n  bottom: 0;\n  left: 50%;\n  transform: translate3d(-50%, 0, 0);\n}\n.popup-slide-bottom-enter,\n.popup-slide-bottom-leave-active {\n  transform: translate3d(-50%, 100%, 0);\n}\n.popup-fade-enter,\n.popup-fade-leave-active {\n  opacity: 0;\n}\n.v-modal-enter {\n  animation: v-modal-in 0.4s ease;\n}\n.v-modal-leave {\n  animation: v-modal-out 0.4s ease forwards;\n}\n@keyframes v-modal-in {\n  0% {\n    opacity: 0;\n  }\n}\n@keyframes v-modal-out {\n  100% {\n    opacity: 0;\n  }\n}\n.v-modal {\n  position: fixed;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  opacity: 0.3;\n  background: #000000;\n}\n");var s=function(e){for(var t=arguments,n=1,o=arguments.length;n<o;n++){var i=t[n]||{};for(var s in i)if(i.hasOwnProperty(s)){var a=i[s];void 0!==a&&(e[s]=a)}}return e},a=function(e){return(e||"").replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")},r=!1,l=function(){if(!Vue.prototype.$isServer){var e=d.modalDom;return e?r=!0:(r=!1,e=document.createElement("div"),d.modalDom=e,e.addEventListener("touchmove",function(e){e.preventDefault(),e.stopPropagation()}),e.addEventListener("click",function(){d.doOnModalClick&&d.doOnModalClick()})),e}},c={},d={zIndex:2e3,modalFade:!0,getInstance:function(e){return c[e]},register:function(e,t){e&&t&&(c[e]=t)},deregister:function(e){e&&(c[e]=null,delete c[e])},nextZIndex:function(){return d.zIndex++},modalStack:[],doOnModalClick:function(){var e=d.modalStack[d.modalStack.length-1];if(e){var t=d.getInstance(e.id);t&&t.closeOnClickModal&&t.close()}},openModal:function(e,t,i,s,a){if(!Vue.prototype.$isServer&&e&&void 0!==t){this.modalFade=a;for(var c=this.modalStack,d=0,p=c.length;d<p;d++){if(c[d].id===e)return}var h=l();if(n(h,"v-modal"),this.modalFade&&!r&&n(h,"v-modal-enter"),s){s.trim().split(/\s+/).forEach(function(e){return n(h,e)})}setTimeout(function(){o(h,"v-modal-enter")},200),i&&i.parentNode&&11!==i.parentNode.nodeType?i.parentNode.appendChild(h):document.body.appendChild(h),t&&(h.style.zIndex=t),h.style.display="",this.modalStack.push({id:e,zIndex:t,modalClass:s})}},closeModal:function(e){var t=this.modalStack,i=l();if(t.length>0){var s=t[t.length-1];if(s.id===e){if(s.modalClass){s.modalClass.trim().split(/\s+/).forEach(function(e){return o(i,e)})}t.pop(),t.length>0&&(i.style.zIndex=t[t.length-1].zIndex)}else for(var a=t.length-1;a>=0;a--)if(t[a].id===e){t.splice(a,1);break}}0===t.length&&(this.modalFade&&n(i,"v-modal-leave"),setTimeout(function(){0===t.length&&(i.parentNode&&i.parentNode.removeChild(i),i.style.display="none",d.modalDom=void 0),o(i,"v-modal-leave")},200))}};!Vue.prototype.$isServer&&window.addEventListener("keydown",function(e){if(27===e.keyCode&&d.modalStack.length>0){var t=d.modalStack[d.modalStack.length-1];if(!t)return;var n=d.getInstance(t.id);n.closeOnPressEscape&&n.close()}});var p,h=1,u=[],f=function(e){if(-1===u.indexOf(e)){var t=function(e){var t=e.__vue__;if(!t){var n=e.previousSibling;n.__vue__&&(t=n.__vue__)}return t};Vue.transition(e,{afterEnter:function(e){var n=t(e);n&&n.doAfterOpen&&n.doAfterOpen()},afterLeave:function(e){var n=t(e);n&&n.doAfterClose&&n.doAfterClose()}})}},m=function(){if(!Vue.prototype.$isServer){if(void 0!==p)return p;var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.position="absolute",e.style.top="-9999px",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var o=n.offsetWidth;return e.parentNode.removeChild(e),t-o}},k=function(e){return 3===e.nodeType&&(e=e.nextElementSibling||e.nextSibling,k(e)),e},v={props:{value:{type:Boolean,default:!1},transition:{type:String,default:""},openDelay:{},closeDelay:{},zIndex:{},modal:{type:Boolean,default:!1},modalFade:{type:Boolean,default:!0},modalClass:{},lockScroll:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!1},closeOnClickModal:{type:Boolean,default:!1}},created:function(){this.transition&&f(this.transition)},beforeMount:function(){this._popupId="popup-"+h++,d.register(this._popupId,this)},beforeDestroy:function(){d.deregister(this._popupId),d.closeModal(this._popupId),this.modal&&null!==this.bodyOverflow&&"hidden"!==this.bodyOverflow&&(document.body.style.overflow=this.bodyOverflow,document.body.style.paddingRight=this.bodyPaddingRight),this.bodyOverflow=null,this.bodyPaddingRight=null},data:function(){return{opened:!1,bodyOverflow:null,bodyPaddingRight:null,rendered:!1}},watch:{value:function(e){var t=this;if(e){if(this._opening)return;this.rendered?this.open():(this.rendered=!0,Vue.nextTick(function(){t.open()}))}else this.close()}},methods:{open:function(e){var t=this;this.rendered||(this.rendered=!0,this.$emit("input",!0));var n=s({},this,e,this.$props);this._closeTimer&&(clearTimeout(this._closeTimer),this._closeTimer=null),clearTimeout(this._openTimer);var o=Number(n.openDelay);o>0?this._openTimer=setTimeout(function(){t._openTimer=null,t.doOpen(n)},o):this.doOpen(n)},doOpen:function(e){if(!this.$isServer&&(!this.willOpen||this.willOpen())&&!this.opened){this._opening=!0,this.visible=!0,this.$emit("input",!0);var t=k(this.$el),n=e.modal,o=e.zIndex;if(o&&(d.zIndex=o),n&&(this._closing&&(d.closeModal(this._popupId),this._closing=!1),d.openModal(this._popupId,d.nextZIndex(),t,e.modalClass,e.modalFade),e.lockScroll)){this.bodyOverflow||(this.bodyPaddingRight=document.body.style.paddingRight,this.bodyOverflow=document.body.style.overflow),p=m();var i=document.documentElement.clientHeight<document.body.scrollHeight;p>0&&i&&(document.body.style.paddingRight=p+"px"),document.body.style.overflow="hidden"}"static"===getComputedStyle(t).position&&(t.style.position="absolute"),t.style.zIndex=d.nextZIndex(),this.opened=!0,this.onOpen&&this.onOpen(),this.transition||this.doAfterOpen()}},doAfterOpen:function(){this._opening=!1},close:function(){var e=this;if(!this.willClose||this.willClose()){null!==this._openTimer&&(clearTimeout(this._openTimer),this._openTimer=null),clearTimeout(this._closeTimer);var t=Number(this.closeDelay);t>0?this._closeTimer=setTimeout(function(){e._closeTimer=null,e.doClose()},t):this.doClose()}},doClose:function(){var e=this;this.visible=!1,this.$emit("input",!1),this._closing=!0,this.onClose&&this.onClose(),this.lockScroll&&setTimeout(function(){e.modal&&"hidden"!==e.bodyOverflow&&(document.body.style.overflow=e.bodyOverflow,document.body.style.paddingRight=e.bodyPaddingRight),e.bodyOverflow=null,e.bodyPaddingRight=null},200),this.opened=!1,this.transition||this.doAfterClose()},doAfterClose:function(){d.closeModal(this._popupId),this._closing=!1}}},b={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("transition",{attrs:{name:e.currentTransition}},[n("div",{directives:[{name:"show",rawName:"v-show",value:e.currentValue,expression:"currentValue"}],staticClass:"c-popup",class:[e.position?"c-popup-"+e.position:""]},[e._t("default")],2)])},staticRenderFns:[],name:"c-popup",mixins:[v],props:{modal:{default:!0},modalFade:{default:!1},lockScroll:{default:!1},closeOnClickModal:{default:!0},popupTransition:{type:String,default:"popup-slide"},position:{type:String,default:""}},data:function(){return{currentValue:!1,currentTransition:this.popupTransition}},watch:{currentValue:function(e){this.$emit("input",e)},value:function(e){this.currentValue=e}},beforeMount:function(){"popup-fade"!==this.popupTransition&&(this.currentTransition="popup-slide-"+this.position)},mounted:function(){this.value&&(this.rendered=!0,this.currentValue=!0,this.open())}},y={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("c-popup",{attrs:{position:"bottom"},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[n("div",{staticClass:"search-stock-box"},[n("div",{staticClass:"search-bar"},[n("div",{staticClass:"search-bar-input"},[n("form",{attrs:{onsubmit:"return false;"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.searchKey,expression:"searchKey"}],ref:"inputSearch",attrs:{type:"search",placeholder:"\u8bf7\u8f93\u5165\u80a1\u7968\u4ee3\u7801 / \u62fc\u97f3\u7b80\u79f0",autoFocus:""},domProps:{value:e.searchKey},on:{input:[function(t){t.target.composing||(e.searchKey=t.target.value)},e.handleInputChange]}})])]),n("a",{staticClass:"search-cancel",attrs:{href:"javascript:;"},on:{click:e.handleClearSearch}},[e._v("\u53d6\u6d88")])]),n("div",{ref:"scrollContent",staticClass:"search-content"},[n("div",{staticClass:"search-content-box"},[e.stockList&&0!==e.stockList.length?n("ul",e._l(e.stockList,function(t){return n("li",{key:t.stock_code,on:{click:function(n){e.choseStock(t)}}},[n("span",{staticClass:"stock-name"},[e._v(e._s(t.stock_name))]),e._v(" "),n("span",{staticClass:"stock-code"},[e._v(e._s(t.stock_code))])])})):e.searchKey||0===e.historyStockList.length?0===e.stockList.length&&0===e.historyStockList.length?n("ul",[n("li",{staticClass:"no-data"},[e.searchKey?n("span",[e._v("\u6682\u65e0\u6570\u636e~")]):n("span",[e._v("\u60a8\u8fd8\u6ca1\u6709\u641c\u7d22\u5386\u53f2~")])])]):e._e():n("ul",[e._l(e.historyStockList,function(t){return n("li",{key:t.stock_code,on:{click:function(n){e.choseStock(t)}}},[n("span",{staticClass:"stock-name"},[e._v(e._s(t.stock_name))]),e._v(" "),n("span",{staticClass:"stock-code"},[e._v(e._s(t.stock_code))])])}),n("li",{staticClass:"no-data"},[n("span",{on:{click:e.handleClearHistory}},[e._v("\u6e05\u7a7a\u641c\u7d22\u5386\u53f2")])])],2),n("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLoading,expression:"!isLoading"}],staticClass:"infinite-scroll-preloader"},[n("div",{staticClass:"preloader"})])])])])])},staticRenderFns:[],name:"search-stock",props:{api:{type:String,default:"api/queryAllStock.json"}},data:function(){return{visible:!1,searchKey:"",pageSize:20,pageNo:0,isLoading:!0,stockList:[],historyStockList:[],allStockList:[]}},created:function(){this.handleSearchAllStock()},mounted:function(){this.handleScroll()},methods:{handleSearchAllStock:function(){var e=this,t=localStorage.HS_search_all_stock;if(t)try{this.allStockList=JSON.parse(t)}catch(e){console.log("\u83b7\u53d6\u6240\u6709\u80a1\u7968\u5217\u8868\u5f02\u5e38"+e)}else axios.get(this.api).then(function(t){var n=t&&t.data;e.allStockList=n.result,localStorage.HS_search_all_stock=JSON.stringify(n.result)})},loadHistoryStock:function(){var e=localStorage.HS_search_history_stock;if(e)try{this.historyStockList=JSON.parse(e)}catch(e){console.log("\u83b7\u53d6\u641c\u7d22\u5386\u53f2\u80a1\u7968\u5217\u8868\u5f02\u5e38"+e)}},open:function(){this.loadHistoryStock(),this.autoFocus()},autoFocus:function(){this.visible=!0,this.$refs.inputSearch.focus()},handleInputChange:function(){if(this.stockList=[],this.searchKey&&this.searchKey.length<=6){var e=this.render();this.stockList=this.stockList.concat(e.list),this.pageNo=e.num}},handleScroll:function(){var e=this,t=this.$refs.scrollContent,n=document.querySelector(".search-content-box");t.addEventListener("scroll",function(){if(t.scrollTop+t.clientHeight>=n.clientHeight&&e.isLoading){e.isLoading=!1;var o=e.render(e.pageNo);e.stockList=e.stockList.concat(o.list),e.pageNo=o.num,setTimeout(function(){e.isLoading=!0},1e3)}})},choseStock:function(e){var t=this;this.$emit("selectStock",e),this.handleClearSearch(),Array.isArray(this.historyStockList)&&this.historyStockList.forEach(function(n,o){e.stock_code==n.stock_code&&t.historyStockList.splice(o,1)}),this.historyStockList.unshift(e);var n=this.historyStockList.slice(0,10);localStorage.HS_search_history_stock=JSON.stringify(n)},render:function(e){var t=this,n=this.searchKey.toUpperCase(),o=[],i=Number(e)||0;if(this.searchKey){var s=0;for(i;i<this.allStockList.length&&this.pageSize!==s;i++)-1===t.allStockList[i].stock_code.indexOf(n)&&-1===t.allStockList[i].stock_phonetic.indexOf(n)&&-1===t.allStockList[i].stock_name.indexOf(n)||(o.push(t.allStockList[i]),s++)}return{list:o,num:i}},handleClearSearch:function(){this.visible=!1,this.searchKey="",this.stockList=[]},handleClearHistory:function(){this.historyStockList=[],localStorage.removeItem("HS_search_history_stock")}},components:{CPopup:b}};return i.version="1.0.0","undefined"!=typeof window&&window.Vue&&window.Vue.use(i),i});